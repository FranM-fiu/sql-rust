DELIMETER ||

CREATE OR REPLACE TRIGGER calculate_final_grade
AFTER INSERT OR UPDATE ON GRADED_COMPONENTS
FOR EACH ROW
DECLARE
    total_points NUMBER;
    final_grade CHAR(1);
BEGIN
    -- Calculate total points for the student in the course
    SELECT SUM(gc.Points * c.Weight) INTO total_points
    FROM GRADED_COMPONENTS gc
    JOIN COMPONENT c ON gc.Course = c.Course_Id AND gc.Comp_Name = c.Name
    WHERE gc.Course = :NEW.Course AND gc.Student = :NEW.Student;

    -- Determine the final grade based on total points
    IF total_points >= 90 THEN
        final_grade := 'A';
    ELSIF total_points >= 80 THEN
        final_grade := 'B';
    ELSIF total_points >= 70 THEN
        final_grade := 'C';
    ELSIF total_points >= 60 THEN
        final_grade := 'D';
    ELSE
        final_grade := 'F';
    END IF;

    -- Update the ENROLLMENT table with the calculated final grade
    UPDATE ENROLLMENT
    SET Final_Grade = final_grade
    WHERE Course = :NEW.Course AND Panther_ID = :NEW.Student;
END ||
DELIMETER ;
